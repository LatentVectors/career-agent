# Technical Specification

This is the technical specification for the spec detailed in @.agent-os/specs/2025-08-11-resume-template-cli-generator/spec.md

## Technical Requirements

- **CLI Placement**: Add a subcommand under the existing `resume` CLI group in `src/features/resume/cli.py` (or a new `cli_templates.py` attached to `resume_app`). Command name proposal: `resume templates new` (alias: `resume template new`).
- **Command Signature**:
  - `description: str` (optional) – Natural-language description of the desired style/layout. If none is provided, the prompt should work as-is without additional guiding descriptions from the user.
  - `--image PATH` (optional) – Local path to a reference image to inform layout/style, or a URL to an image hosted somewhere online.
  - `--name TEXT` (optional) – Template slug (default: autogenerated, e.g., `template_YYYYMMDD_HHMM`).
  - `--outdir PATH` (optional; default: `data/templates/generated`).
  - `--pdf/--no-pdf` (optional; default: `--no-pdf`).
- **Prompt Assembly**:
  - Define a function the CLI command calls for calling the LLM and returning the template.
  - Use `src/features/resume/prompt.py:resume_template_prompt` as the base system/content guidance.
  - Combine with the user-provided `description` and, if present, attach the image as multimodal content.
  - Follow LangChain multimodal inputs for OpenAI (`init_chat_model("openai:gpt-4o")`). If `--image` provided, read the file and include via base64-encoded `image_url` content; otherwise, omit images entirely.
- **Model Access**:
  - Reuse centralized model helpers in `src/core/models.py:get_model` with `ModelName.gpt_4o` / `ModelName.gpt_4o_mini` where possible.
- **Template Validation Rules**:
  - Enforce the Jinja2 data contract defined in `resume_template_prompt` (keys: `name`, `title`, `email`, `phone`, `linkedin_url`, `professional_summary`, `experience[*].{title,company,location,start_date,end_date,points}`, `education[*].{degree,major,institution,grad_date}`, `skills`, `certifications[*].{title,date}`).
  - Require conditional `{% if ... %}` wrappers around each list-based or optional section, including section headers.
  - Restrict CSS to web-safe fonts and single-column layout (skills may use `column-count`).
  - Define template validation in its own function.
- **Outputs** (under `data/templates/generated/YYYYMMDD/<slug>/`):
  - `<slug>.html` – Raw generated Jinja2 template.
  - `<slug>__preview.pdf` – Optional PDF preview when `--pdf` is provided.
- **Rendering**:
  - Build the rendering `context` from selected `DUMMY_RESUME_DATA` in `src/features/resume/content.py`.
  - Use `src/features/resume/utils.py:render_template_to_html` for rendering to HTML string when possible; if the generated template is not yet on the templates search path, load it from disk into a Jinja2 environment that points at the output directory.
  - For PDF, reuse `render_template_to_pdf` or `convert_html_to_pdf` utilities.
- **Error Handling**:
  - Validate `--image` path existence before attempting multimodal; if invalid, warn and proceed without image.
  - Validate the generated HTML contains required placeholders at least for `name`, `title`, and one list section; otherwise, print a clear warning and still save artifacts for manual review.
- **Logging and UX**:
  - Print saved file locations and quick next steps (e.g., "copy approved template to `src/features/resume/templates/`").
  - Keep expensive imports inside the command per CLI best practices.

## External Dependencies (Conditional)

No new dependencies required. Image reading uses Python stdlib (`base64`, `mimetypes`, `pathlib`). Multimodal support is provided by LangChain OpenAI chat models already present in the stack.
